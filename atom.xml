<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Srikanth]]></title>
  <link href="http://sri-sankl.github.io/atom.xml" rel="self"/>
  <link href="http://sri-sankl.github.io/"/>
  <updated>2016-05-25T10:13:37+05:30</updated>
  <id>http://sri-sankl.github.io/</id>
  <author>
    <name><![CDATA[sri-sankl]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Lambda Expressions in Java 8]]></title>
    <link href="http://sri-sankl.github.io/blog/2016/05/17/lambda-expressions-in-java-8/"/>
    <updated>2016-05-17T22:42:12+05:30</updated>
    <id>http://sri-sankl.github.io/blog/2016/05/17/lambda-expressions-in-java-8</id>
    <content type="html"><![CDATA[<blockquote><p>Lambda Expression is a way of writing an implamementation of a method for later execution.</p></blockquote>

<p>Lambdas are also known as <em>closures</em> or <em>anonymous functions</em>.</p>

<h5>Syntax:</h5>

<p>  Lambda expression consists of three parts.
  1. A paranthesized set of parameters.
  2. An arrow
  3. A body</p>

<figure class='code'><figcaption><span>Lambda Expression</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">()</span> <span class="o">-&gt;</span> <span class="c1">//my single statement;</span>
</span><span class='line'><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="c1">//my single statement;</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<!--more-->


<p>
 If we have multiple statements in body part, we have to write them inside the curly braces and the last statement should return the result.</p>

<figure class='code'><figcaption><span>Lambda Expression</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span><span class='line'>  <span class="c1">//my steatement1</span>
</span><span class='line'>  <span class="c1">//.....</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">someValue</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>
<b> <em>Note:</em> </b>Lambdas can not <code>break</code> or <code>continue</code> out of the body.</p>

<h5>Functional Interface:</h5>

<p>  It is an interface which requires only one method to be implemented in order to satisfy the requirements of the interface.</p>

<figure class='code'><figcaption><span>MySampleInteface.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MySampleInterface</span> <span class="o">{</span>
</span><span class='line'>  <span class="kt">void</span> <span class="nf">mySampleMethod</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p> We can implement this interface using an anonynous class</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'> <span class="n">MySampleInterface</span> <span class="n">msi</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">MySampleInterface</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="nd">@Override</span>
</span><span class='line'>      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">myMethod</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>          <span class="c1">// My implementation logic</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">};</span>
</span><span class='line'> <span class="n">msi</span><span class="o">.</span><span class="na">myMethod</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<p> We can simplify this entire story into a single statement using lambdas.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>     <span class="n">MySampleInterface</span> <span class="n">msi</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;I am implementing a functional interface&quot;</span><span class="o">);</span>
</span><span class='line'>     <span class="n">msi</span><span class="o">.</span><span class="na">myMethod</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>  This is how the lambdas are implemented. Thre is no ambiguity around which method of the interface lambda is trying to implement.
<br/>
The designers of java8 also provided an annotation <code>@FunctionalInterface</code> to serve as a documentations hint that an interface is a functional interface. Its not mandatory to keep this annotation though.
<br/>
Java has some functional interfaces, such as <code>Runnable</code>, <code>Comparator&lt;T&gt;</code> etc.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Runnable</span> <span class="n">r</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Lambda Implemented run method&quot;</span><span class="o">);</span>
</span><span class='line'><span class="n">r</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Comparator</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">c</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span> <span class="n">lhs</span><span class="o">,</span> <span class="n">String</span> <span class="n">rhs</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span><span class='line'>              <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Comparing &quot;</span><span class="o">+</span><span class="n">lhs</span><span class="o">+</span> <span class="s">&quot; with &quot;</span><span class="o">+</span> <span class="n">rhs</span> <span class="o">);</span>
</span><span class='line'>              <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">rhs</span><span class="o">);</span>
</span><span class='line'>          <span class="o">};</span>
</span><span class='line'><span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="s">&quot;Hello&quot;</span><span class="o">,</span> <span class="s">&quot;world&quot;</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<h5>Type Inference</h5>

<p> Java 8 is providing enhanced type inferences. In the above example the target type is a<code>Comparator&lt;String&gt;</code>, the objects passed to the lambda should be String or its subtype.
 In this case we can leave the <code>String</code> declaration in front of <code>lhs</code> and <code>rhs</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Comparator</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">c</span> <span class="o">=</span> <span class="o">(</span><span class="n">lhs</span><span class="o">,</span> <span class="n">rhs</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span><span class='line'>              <span class="k">return</span> <span class="n">lhs</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">rhs</span><span class="o">);</span>
</span><span class='line'>          <span class="o">};</span>
</span><span class='line'><span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="s">&quot;Hello&quot;</span><span class="o">,</span> <span class="s">&quot;world&quot;</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>For the first in the java world lambda reference cannot directly be assigned to the <code>Object</code> class. Since <code>Object</code> is not a functional interface. We have to cast to its target type to assign to a <code>Object</code> type reference.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="o">(</span><span class="n">Runnable</span><span class="o">)</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Hello World&quot;</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<h5>Lixical Scoping:</h5>

<p> When we are working with a inner class, we need to write a special syntax to access the outer scope from the inner class.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Hello</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">Runnable</span> <span class="n">r</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Runnable</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="nd">@Override</span>
</span><span class='line'>      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Hello</span><span class="o">.</span><span class="na">this</span><span class="o">);</span>
</span><span class='line'>          <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Hello</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">};</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="s">&quot;I am in Hello class&quot;</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can simplify this using lambds. Lambdas are lexically scoped. This means that they recognizes their immediate environment as the next outer most scope.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Hello</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">Runnable</span> <span class="n">r</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span><span class='line'>      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">toString</span><span class="o">());</span>
</span><span class='line'>  <span class="o">};</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="s">&quot;I am in Hello class&quot;</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>this</code> no longer refers to the lambda itself. Both the above examples provides the same output.</p>

<p>Lambdas can refer to it&rsquo;s immediate outer scoped local variables but these are effectively final meaning that its final in all but name.
 It can refer but can not modify local variable <code>message</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[])</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="s">&quot;Hello&quot;</span><span class="o">;</span>
</span><span class='line'>      <span class="n">Runnable</span> <span class="n">r1</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">r1</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[])</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">StringBuilder</span> <span class="n">message</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="o">(</span><span class="s">&quot;Hello&quot;</span><span class="o">);</span>
</span><span class='line'>  <span class="n">Runnable</span> <span class="n">r1</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
</span><span class='line'>          <span class="n">message</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot; &quot;</span><span class="o">);</span>
</span><span class='line'>          <span class="n">message</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;World&quot;</span><span class="o">);</span>
</span><span class='line'>          <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
</span><span class='line'>  <span class="o">};</span>
</span><span class='line'>  <span class="n">r1</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p> Here <code>final</code> modifier applied to only the reference but not on the right side object.</p>

<h5>Method References:</h5>

<p>Lambdas not only difined at the point of usage. We can also define lambdas for later use.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">String</span> <span class="n">firstName</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">String</span> <span class="n">lastName</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="nf">Person</span><span class="o">(</span><span class="n">String</span> <span class="n">firstName</span><span class="o">,</span> <span class="n">String</span> <span class="n">lastName</span><span class="o">,</span> <span class="kt">int</span> <span class="n">age</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">this</span><span class="o">.</span><span class="na">firstName</span> <span class="o">=</span> <span class="n">firstName</span><span class="o">;</span>
</span><span class='line'>      <span class="k">this</span><span class="o">.</span><span class="na">lastName</span> <span class="o">=</span> <span class="n">lastName</span><span class="o">;</span>
</span><span class='line'>      <span class="k">this</span><span class="o">.</span><span class="na">age</span> <span class="o">=</span> <span class="n">age</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">compareByFirstName</span> <span class="o">=</span> <span class="o">(</span><span class="n">lhs</span><span class="o">,</span> <span class="n">rhs</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">lhs</span><span class="o">.</span><span class="na">firstName</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">rhs</span><span class="o">.</span><span class="na">firstName</span><span class="o">);</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">compareByLasteName</span> <span class="o">=</span> <span class="o">(</span><span class="n">lhs</span><span class="o">,</span> <span class="n">rhs</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">lhs</span><span class="o">.</span><span class="na">lastName</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">rhs</span><span class="o">.</span><span class="na">lastName</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="s">&quot;FirstName: &quot;</span> <span class="o">+</span> <span class="n">firstName</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[])</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;();</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">persons</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nf">Person</span><span class="o">(</span><span class="s">&quot;Sri&quot;</span><span class="o">,</span> <span class="s">&quot;Sankl&quot;</span><span class="o">,</span> <span class="mi">22</span><span class="o">));</span>
</span><span class='line'>      <span class="n">persons</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nf">Person</span><span class="o">(</span><span class="s">&quot;Nani&quot;</span><span class="o">,</span> <span class="s">&quot;Hero&quot;</span><span class="o">,</span> <span class="mi">26</span><span class="o">));</span>
</span><span class='line'>      <span class="n">persons</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nf">Person</span><span class="o">(</span><span class="s">&quot;Rehman&quot;</span><span class="o">,</span> <span class="s">&quot;A.R&quot;</span><span class="o">,</span> <span class="mi">26</span><span class="o">));</span>
</span><span class='line'>      <span class="n">persons</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nf">Person</span><span class="o">(</span><span class="s">&quot;Bahubali&quot;</span><span class="o">,</span> <span class="s">&quot;Rajamouli&quot;</span><span class="o">,</span> <span class="mi">21</span><span class="o">));</span>
</span><span class='line'>      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">persons</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">persons</span><span class="o">,</span> <span class="n">Person</span><span class="o">.</span><span class="na">compareByFirstName</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">persons</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Comparator <code>compareByFirstName</code> is defined as a static final field and it can be referenced as any other static field could be referenced.</p>

<blockquote><p>Thank you for reading the post. Feel free to comment.
Happy Coding..:)</p></blockquote>

<h6>References:</h6>

<ol>
<li><a href="http://www.oracle.com/technetwork/articles/java/architect-lambdas-part1-2080972.html">http://www.oracle.com/technetwork/articles/java/architect-lambdas-part1-2080972.html</a></li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Metaprogramming in Ruby: Implementing Class Extension Mixins]]></title>
    <link href="http://sri-sankl.github.io/blog/2016/01/26/metaprogramming-in-ruby-implementing-class-extension-mixins/"/>
    <updated>2016-01-26T19:38:53+05:30</updated>
    <id>http://sri-sankl.github.io/blog/2016/01/26/metaprogramming-in-ruby-implementing-class-extension-mixins</id>
    <content type="html"><![CDATA[<blockquote><p>Metaprogramming: Code that writes code</p></blockquote>

<h5>Problem statement:</h5>

<p>  In Indian payroll system, many compements are based on the <code>basic</code>. These components varies from company to company. Below <code>payslip_breakups</code> table shows the different components and their value from <code>basic</code> in percentages.</p>

<table>
<thead>
<tr>
<th> component_code              </th>
<th style="text-align:center;">  criteria     </th>
</tr>
</thead>
<tbody>
<tr>
<td>    hra                      </td>
<td style="text-align:center;">     50        </td>
</tr>
<tr>
<td> city_compensatory_allowance </td>
<td style="text-align:center;">     10        </td>
</tr>
<tr>
<td> employer_pf_contribution    </td>
<td style="text-align:center;">     12        </td>
</tr>
<tr>
<td> bonus_payment               </td>
<td style="text-align:center;">     15        </td>
</tr>
</tbody>
</table>


<p> These components are dynamic and has to be evaluated at run time.</p>

<!--more-->


<p></p>

<h5>Hook Methods:</h5>

<p> Whenever we write code in the object oriented programming, we will face several situations such as inheriting classes, mixing modules into classes and defining, undefining and removing methods. Metaprogramming helps us to define some methods to handle these events and do some workaround when these events fired. These methods are known as the <strong>Hook Methods</strong>.</p>

<figure class='code'><figcaption><span>payslip_breakup_mixin.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">PayslipBreakupMixin</span>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">included</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;PayslipBreakupMixin was mixed into </span><span class="si">#{</span><span class="n">base</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span>payslip.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Payslip</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">PayslipBreakupMixin</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p> <code>included()</code> is the hook method which will be invoked when the module is included in other class and it will accept the including class as it&rsquo;s parameter. We can override this method and implement our own logic.
<br/>
Eg: <code>extend_object()</code>, <code>method_added()</code>, <code>method_removed()</code>, <code>method_undefined</code> are some hook methods</p>

<h5>Implementing hook method and using class macros</h5>

<figure class='code'><figcaption><span>payslip_breakup_mixin.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">PayslipBreakupMixin</span>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:basic</span>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">included</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
</span><span class='line'>    <span class="n">base</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="no">ClassMethods</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">module</span> <span class="nn">ClassMethods</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">attr_on_basic</span><span class="p">(</span><span class="o">*</span><span class="n">params</span><span class="p">)</span>
</span><span class='line'>      <span class="n">params</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">param</span><span class="o">|</span>
</span><span class='line'>        <span class="n">define_method</span> <span class="n">param</span><span class="o">.</span><span class="n">to_sym</span> <span class="k">do</span>
</span><span class='line'>          <span class="p">((</span><span class="n">component_criterias</span><span class="o">[</span><span class="n">param</span><span class="o">.</span><span class="n">to_sym</span><span class="o">]/</span><span class="mi">100</span><span class="p">)</span><span class="o">*</span><span class="n">basic</span><span class="o">.</span><span class="n">to_i</span><span class="p">)</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="kp">private</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">component_criterias</span>
</span><span class='line'>      <span class="vi">@component_criterias</span> <span class="o">||=</span> <span class="no">PayslipBreakUp</span><span class="o">.</span><span class="n">belongs_to_salary</span><span class="o">.</span><span class="n">map</span><span class="p">{</span><span class="o">|</span><span class="n">break_up</span><span class="o">|</span> <span class="o">[</span><span class="n">break_up</span><span class="o">.</span><span class="n">component_code</span><span class="o">.</span><span class="n">to_sym</span><span class="p">,</span> <span class="n">break_up</span><span class="o">.</span><span class="n">criteria</span><span class="o">]</span> <span class="p">}</span><span class="o">.</span><span class="n">to_h</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p> In the above mixin, <code>included()</code> method will be called by Ruby, when an inclusor(which included this module into it) includes the mixin. The <code>extend()</code> method will add the <code>ClassMethods</code> module&rsquo;s methods into the inclusor&rsquo;s Eigen class.
<br>
Eigen class is known as Object&rsquo;s own class. Every object has its own class and class itself is an object of the class <code>Class</code>.</p>

<h6>ClassMethods Explained</h6>

<ol>
<li><code>attr_on_basic()</code> method accepts parameteters to which we need to calculate the value based on basic.</li>
<li><code>define_method()</code> creates a dynamic method for each parameter.</li>
<li><code>component_criterias()</code> fetches all the breakup component criterias and creates a map.</li>
<li><code>basic</code> should be an instance valriable in the included class and it can be red by it&rsquo;s accessor.</li>
</ol>


<figure class='code'><figcaption><span>payslip.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Payslip</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">PayslipBreakupMixin</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>When we include the <code>PayslipBreakupMixin</code> into the payslip class. These events will be triggered:</p>

<ol>
<li>Ruby calls a Hook Method: the <code>included()</code> method</li>
<li>The hook turns back to the including class (which is sometimes called the inclusor, or the base in this case) and extends it with the ClassMethods module.</li>
<li>The <code>extend()</code> method includes the methods from ClassMethods in the inclusor&rsquo;s eigenclass.</li>
</ol>


<h5>Class Macros</h5>

<figure class='code'><figcaption><span>payslip.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Payslip</span>
</span><span class='line'>  <span class="kp">attr_accessor</span> <span class="ss">:basic</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">PayslipBreakupMixin</span>
</span><span class='line'>  <span class="n">attr_on_basic</span> <span class="ss">:hra</span><span class="p">,</span> <span class="ss">:city_compensatory_allowance</span><span class="p">,</span> <span class="ss">:employer_pf_contribution</span><span class="p">,</span> <span class="ss">:bonus_payment</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">basic</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@basic</span> <span class="o">=</span> <span class="n">basic</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>  <strong>Class macros</strong> are the class level methods which creates some dynamic code for the given attributes</p>

<ol>
<li><code>attr_on_basic()</code> is a class macro and it takes some arguments and defines the given methods in it&rsquo;s respected eagen class.</li>
<li><code>attr_accessor()</code>, <code>attr_reader()</code>, <code>attr_writer()</code> etc.. are the class macros provided by ruby.</li>
</ol>


<p> <code>attr_on_basic()</code> method defines a method for each <code>:hra</code>, <code>:city_compensatory_allowance</code>, <code>:employer_pf_contribution</code>, <code>:bonus_payment</code> component. These component definations will fetch their respected value percentages from  <code>payslip_breakups</code> model and it will calculate it&rsquo;s absolute value by using <code>basic</code> and will return the final result.</p>

<blockquote><p>Thank you for reading this post. Feel free to comment.
Happy Coding..:)</p></blockquote>

<h6>References:</h6>

<ol>
<li>Metaprogramming Ruby-Paolo Perrotta</li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ajax Pagination With Angularjs and Rails Using Will_paginate]]></title>
    <link href="http://sri-sankl.github.io/blog/2014/11/29/ajax-pagination-with-angularjs-and-rails-using-will-paginate/"/>
    <updated>2014-11-29T12:59:40+05:30</updated>
    <id>http://sri-sankl.github.io/blog/2014/11/29/ajax-pagination-with-angularjs-and-rails-using-will-paginate</id>
    <content type="html"><![CDATA[<p>I use pagination when I need to list a large number of records. In rails, we use <a href="https://github.com/mislav/will_paginate">Will Paginate</a> gem for accomplishing pagination. While dealing with pagination in a single page application(SPA)s, <code>will_paginate</code> along with the angularjs makes the implementations simpler and faster. AngularJS provides a powerful component called <a href="https://docs.angularjs.org/guide/directive">Directives</a> which can be used for implementation of reusable pagination component.<br>
  <p>In this post we will implement a dynamic, reusable pagination component, which is implemented using will_paginate and angular_directives.</p></p>

<h5>Preview:</h5>

<p>   Let us consider a Books listing page. There are a total of 14 books and the screen displays 3 books per page.</p>

<p><img src="http://sri-sankl.github.io/images/books_1.png" alt="pagination" />
<img src="http://sri-sankl.github.io/images/books_2.png" alt="pagination" />
<img src="http://sri-sankl.github.io/images/books_3.png" alt="pagination" />
</p>
   The circled component is the pagination directive which we are going to implement.</p>

<!--more-->


<p></p>

<h5>Gems used:</h5>

<figure class='code'><figcaption><span>Gemfile  </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;haml-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 0.5.3&#39;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;angularjs-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 1.2.22&#39;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;angular-rails-templates&#39;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;will_paginate&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 3.0.7&#39;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;font-awesome-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 4.2.0.0&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li><code>will_paginate</code> is the rails gem for pagiantion</li>
<li><code>font-awesome-rails</code> is rails gem which wraps the beutiful <a href="http://fortawesome.github.io/Font-Awesome">Font Awesome</a> icons library.</li>
<li>Rest of the gems are discussed in the previous <a href="http://sri-sankl.github.io/blog/2014/11/05/connecting-angularjs-resource-with-rails/">post</a>
</p>
Now do <code>bundle install</code><br></li>
</ol>


<h4>Implementation:</h4>

<p> Get the json list of books along with the pagination properties.</p>

<figure class='code'><figcaption><span>app/controllers/books_controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">BooksController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">index</span>
</span><span class='line'>    <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
</span><span class='line'>      <span class="nb">format</span><span class="o">.</span><span class="n">json</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">page</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:page</span><span class="o">].</span><span class="n">present?</span> <span class="p">?</span> <span class="n">params</span><span class="o">[</span><span class="ss">:page</span><span class="o">]</span> <span class="p">:</span> <span class="mi">1</span>
</span><span class='line'>        <span class="vi">@books</span> <span class="o">=</span> <span class="no">Book</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">paginate</span><span class="p">(</span><span class="ss">:page</span> <span class="o">=&gt;</span> <span class="n">page</span><span class="p">,</span> <span class="ss">:per_page</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">)</span>
</span><span class='line'>        <span class="n">render</span> <span class="ss">:json</span> <span class="o">=&gt;</span> <span class="no">Paginator</span><span class="o">.</span><span class="n">pagination_attributes</span><span class="p">(</span><span class="vi">@books</span><span class="p">)</span><span class="o">.</span><span class="n">merge!</span><span class="p">(</span><span class="ss">:books</span> <span class="o">=&gt;</span> <span class="vi">@books</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>      <span class="nb">format</span><span class="o">.</span><span class="n">html</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li><code>paginate()</code> method injects pagination properties into the result.</li>
<li><code>paginate()</code> method accepts pagination options. <code>page</code> is the required attribute and others are optional.</li>
<li>We define a <code>Paginator</code> class whose responsibility is to collect pagination attributes from the given object and returns a hash that contains <em>current_page, start_index, to_index and total_pages</em>.</li>
</ol>


<figure class='code'><figcaption><span>lib/paginator.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Paginator</span>
</span><span class='line'>  <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">pagination_attributes</span><span class="p">(</span><span class="n">source_obj</span><span class="p">,</span> <span class="n">data_hash</span> <span class="o">=</span> <span class="p">{})</span>
</span><span class='line'>      <span class="n">data_hash</span><span class="o">[</span><span class="ss">:total_entries</span><span class="o">]</span> <span class="o">=</span> <span class="n">source_obj</span><span class="o">.</span><span class="n">total_entries</span>
</span><span class='line'>      <span class="n">previous_page</span> <span class="o">=</span> <span class="n">source_obj</span><span class="o">.</span><span class="n">previous_page</span><span class="o">.</span><span class="n">present?</span> <span class="p">?</span> <span class="n">source_obj</span><span class="o">.</span><span class="n">previous_page</span> <span class="p">:</span> <span class="mi">0</span>
</span><span class='line'>      <span class="n">data_hash</span><span class="o">[</span><span class="ss">:current_page</span><span class="o">]</span> <span class="o">=</span> <span class="n">previous_page</span><span class="o">+</span><span class="mi">1</span>
</span><span class='line'>      <span class="n">data_hash</span><span class="o">[</span><span class="ss">:to_index</span><span class="o">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_hash</span><span class="o">[</span><span class="ss">:current_page</span><span class="o">]</span> <span class="o">*</span> <span class="n">source_obj</span><span class="o">.</span><span class="n">per_page</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">source_</span> <span class="n">obj</span><span class="o">.</span><span class="n">total_entries</span> <span class="p">?</span> <span class="n">source_obj</span><span class="o">.</span><span class="n">total_entries</span> <span class="p">:</span> <span class="p">(</span><span class="n">data_hash</span><span class="o">[</span><span class="ss">:current_page</span><span class="o">]</span> <span class="o">*</span> <span class="n">source_obj</span><span class="o">.</span><span class="n">per_page</span><span class="p">)</span>
</span><span class='line'>      <span class="n">data_hash</span><span class="o">[</span><span class="ss">:from_index</span><span class="o">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">previous_page</span> <span class="o">*</span> <span class="n">source_obj</span><span class="o">.</span><span class="n">per_page</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
</span><span class='line'>      <span class="n">data_hash</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><b> <em>Note:</em> </b>Since paginator.rb is located in <code>/lib</code> directory, we have to load this directory</p>

<figure class='code'><figcaption><span>`config/application.rb` </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">autoload_paths</span> <span class="o">+=</span> <span class="sx">%W(</span><span class="si">#{</span><span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="si">}</span><span class="sx">/lib/)</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<h5>Bootstrap Angular Application</h5>

<figure class='code'><figcaption><span>app/assets/javascripts/ng_initialize.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">myApp</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s2">&quot;myApp&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;ngResource&#39;</span><span class="p">,</span> <span class="s1">&#39;myTemplates&#39;</span><span class="p">])</span>
</span></code></pre></td></tr></table></div></figure>


<p>  Configuring angularjs and its dependent modules are discussed in <a href="http://sri-sankl.github.io/blog/2014/11/05/connecting-angularjs-resource-with-rails/">connecting angularjs with rails</a>
<br/>
Write an angular Book service which fetches the list of books</p>

<figure class='code'><figcaption><span>app/assets/services/book.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">angular</span><span class="p">,</span> <span class="nx">app</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">app</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s2">&quot;bookService&quot;</span><span class="p">,[</span><span class="s2">&quot;$http&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$http</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">books</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">page</span><span class="p">){</span>
</span><span class='line'>            <span class="k">return</span> <span class="nx">$http</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;/books.json&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">params</span><span class="o">:</span> <span class="p">{</span><span class="nx">page</span><span class="o">:</span> <span class="nx">page</span> <span class="p">}})</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">books</span> <span class="o">:</span> <span class="nx">books</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}]);</span>
</span><span class='line'><span class="p">})(</span><span class="nx">angular</span><span class="p">,</span> <span class="nx">myApp</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<h5>Define Angular Controller</h5>

<figure class='code'><figcaption><span>app/controllers/books_controller.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">angular</span><span class="p">,</span> <span class="nx">app</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s2">&quot;BooksController&quot;</span><span class="p">,[</span><span class="s2">&quot;bookService&quot;</span><span class="p">,</span> <span class="s2">&quot;$scope&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">bookService</span><span class="p">,</span> <span class="nx">$scope</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">$scope</span><span class="p">.</span><span class="nx">getBooks</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">page</span><span class="p">){</span>
</span><span class='line'>            <span class="nx">bookService</span><span class="p">.</span><span class="nx">books</span><span class="p">(</span><span class="nx">page</span><span class="p">)</span>
</span><span class='line'>                <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
</span><span class='line'>                    <span class="nx">$scope</span><span class="p">.</span><span class="nx">books</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">books</span>
</span><span class='line'>                    <span class="nx">$scope</span><span class="p">.</span><span class="nx">from_index</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">from_index</span>
</span><span class='line'>                    <span class="nx">$scope</span><span class="p">.</span><span class="nx">to_index</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">to_index</span>
</span><span class='line'>                    <span class="nx">$scope</span><span class="p">.</span><span class="nx">total_entries</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">total_entries</span><span class="p">;</span>
</span><span class='line'>                    <span class="nx">$scope</span><span class="p">.</span><span class="nx">current_page</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">current_page</span><span class="p">)</span>
</span><span class='line'>                <span class="p">})</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}])</span>
</span><span class='line'><span class="p">})(</span><span class="nx">angular</span><span class="p">,</span> <span class="nx">myApp</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>Inject book service into the controller</li>
<li><code>getBooks</code> method queries the <code>bookService</code> with the required <code>page</code> number.</li>
<li><code>books</code> data as well as the pagination attributes are made available in the scope of <code>BooksController</code></li>
<li><code>from_index</code>, <code>to_index</code>, <code>total_entries</code>, <code>current_page</code> are made to available in its scope</li>
</ol>


<h4>Define a reusable directive</h4>

<h5>Directive Usage</h5>

<figure class='code'><figcaption><span>app/views/books/index.html.haml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='haml'><span class='line'><span class="nc">.col-md-4</span><span class="p">{</span><span class="ss">:ng_controller</span> <span class="o">=&gt;</span> <span class="s2">&quot;BooksController&quot;</span><span class="p">,</span> <span class="ss">:ng_init</span> <span class="o">=&gt;</span> <span class="s2">&quot;getBooks(1)&quot;</span><span class="p">}</span>
</span><span class='line'>  <span class="nt">%my-pagination</span><span class="p">{</span><span class="ss">:from</span> <span class="o">=&gt;</span> <span class="s2">&quot;from_index&quot;</span><span class="p">,</span> <span class="ss">:to</span> <span class="o">=&gt;</span> <span class="s2">&quot;to_index&quot;</span><span class="p">,</span> <span class="ss">:current_page</span> <span class="o">=&gt;</span> <span class="s2">&quot;current_page&quot;</span><span class="p">,</span> <span class="ss">:total</span><span class="o">=&gt;</span> <span class="s2">&quot;total_entries&quot;</span><span class="p">,</span> <span class="ss">:action</span> <span class="o">=&gt;</span> <span class="s2">&quot;getBooks(page)&quot;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>The custom element <code>my-pagination</code> is a directive and it has the attributes <em>from, to, current_page, total</em>.</li>
<li><code>from</code> is assigned with <code>from_index</code>, a scoped variable which is under <code>Bookscontroller</code>.</li>
<li><code>to</code> is assigned with <code>to_index</code>.</li>
<li><code>current_page</code> is assigned with <code>current_page</code>.</li>
<li><code>total</code> is assigned with <code>total_entries</code>.</li>
<li><code>ation</code> is reffered to the <code>getBooks()</code> method, which is defined in <code>Bookscontroller</code>.</li>
</ol>


<h5>Directive Defination</h5>

<figure class='code'><figcaption><span>app/assets/javascripts/directives/pagination.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">angular</span><span class="p">,</span> <span class="nx">app</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">app</span><span class="p">.</span><span class="nx">directive</span><span class="p">(</span><span class="s2">&quot;myPagination&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">restrict</span><span class="o">:</span> <span class="s1">&#39;E&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">scope</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">from</span><span class="o">:</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">to</span><span class="o">:</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">total</span><span class="o">:</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span>
</span><span class='line'>                <span class="nx">currentPage</span><span class="o">:</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">action</span><span class="o">:</span> <span class="s1">&#39;&amp;&#39;</span>
</span><span class='line'>      <span class="p">},</span>
</span><span class='line'>      <span class="nx">controller</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;$scope&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">){</span>
</span><span class='line'>      <span class="nx">$scope</span><span class="p">.</span><span class="nx">previousPage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>          <span class="nx">$scope</span><span class="p">.</span><span class="nx">currentPage</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span class='line'>          <span class="nx">$scope</span><span class="p">.</span><span class="nx">action</span><span class="p">({</span><span class="nx">page</span><span class="o">:</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">currentPage</span><span class="p">})</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="nx">$scope</span><span class="p">.</span><span class="nx">nextPage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>          <span class="nx">$scope</span><span class="p">.</span><span class="nx">currentPage</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>          <span class="nx">$scope</span><span class="p">.</span><span class="nx">action</span><span class="p">({</span><span class="nx">page</span><span class="o">:</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">currentPage</span><span class="p">})</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="p">}],</span>
</span><span class='line'>      <span class="nx">templateUrl</span><span class="o">:</span> <span class="s2">&quot;paginationElements.html&quot;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'><span class="p">})(</span><span class="nx">angular</span><span class="p">,</span> <span class="nx">myApp</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>The element <code>my_pagination</code> maps to <code>myPagination</code> directive. This mapping has been done by angular <a href="https://docs.angularjs.org/guide/directive">normalization</a></li>
<li>Our directive is restricted to element by defining <code>restrict</code> with <code>E</code>.</li>
<li><b><em>Scope</em></b> creates an <em>Isolate Scope</em> to this directive so that we can reuse it any where.

<ol>
<li><code>from: '='</code> is similar to <code>from : = from</code>. It states that <code>from</code> property of directive scope is bind with the value assigned to the <code>from</code> attribute of <code>my_pagination</code> element.</li>
<li><code>action: '&amp;'</code> is similar to <code>action: &amp;action</code>. <code>&amp;</code> binding is used evalute the expression or function defined on <code>action</code> attribute of <code>my_pagination</code> element.</li>
</ol>
</li>
<li><p><b><em>Controller</em></b>: Isolated Scoped attributes can access and manipulated by its own controller.</p>

<ol>
<li><code>previousPage()</code> method is to show the previous page. It decreases <code>currentPage</code> by 1 and invokes the <code>action</code> attributes value. <code>{page: $scope.currentPage}</code> is passed as the page parameter to the <code>getBooks(page)</code> function.</li>
<li><code>nextPage()</code> method is to show the previous page. It increases <code>currentPage</code> by 1 and invokes the <code>action</code> attributes value.</li>
</ol>
</li>
<li><p><b><em>TemplateUrl</em></b>: It is path to the html content.
Here is the code</p></li>
</ol>


<figure class='code'><figcaption><span>app/assets/templates/paginationElements.html.haml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='haml'><span class='line'><span class="nt">%span</span>
</span><span class='line'>  {{from}} - {{to}} of {{total}}
</span><span class='line'><span class="nc">.btn-group.btn-group-sm</span>
</span><span class='line'>  <span class="nt">%button</span><span class="nc">.btn.btn-default</span><span class="p">{</span><span class="ss">:ng_click</span> <span class="o">=&gt;</span> <span class="s2">&quot;previousPage()&quot;</span><span class="p">,</span> <span class="ss">:ng_class</span> <span class="o">=&gt;</span> <span class="s2">&quot;{&#39;disabled&#39;: from == 1}</span>&quot;}
</span><span class='line'>    <span class="nt">%i</span><span class="nc">.fa.fa-chevron-left.fa-lg</span>
</span><span class='line'>  <span class="nt">%button</span><span class="nc">.btn.btn-default</span><span class="p">{</span><span class="ss">:ng_click</span> <span class="o">=&gt;</span> <span class="s2">&quot;nextPage()&quot;</span><span class="p">,</span> <span class="ss">:ng_class</span> <span class="o">=&gt;</span> <span class="s2">&quot;{&#39;disabled&#39;: to == total}</span>&quot;}
</span><span class='line'>    <span class="nt">%i</span><span class="nc">.fa.fa-chevron-right.fa-lg</span>
</span></code></pre></td></tr></table></div></figure>


<h5>The final index view is</h5>

<figure class='code'><figcaption><span>app/views/books/index.html.haml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='haml'><span class='line'><span class="nc">.col-md-4</span><span class="p">{</span><span class="ss">:ng_controller</span> <span class="o">=&gt;</span> <span class="s2">&quot;BooksController&quot;</span><span class="p">,</span> <span class="ss">:ng_init</span> <span class="o">=&gt;</span> <span class="s2">&quot;getBooks(1)&quot;</span><span class="p">}</span>
</span><span class='line'>  <span class="nt">%h3</span>
</span><span class='line'>    Books
</span><span class='line'>    <span class="nc">.pull-right</span>
</span><span class='line'>      <span class="nt">%my-pagination</span><span class="p">{</span><span class="ss">:from</span> <span class="o">=&gt;</span> <span class="s2">&quot;from_index&quot;</span><span class="p">,</span> <span class="ss">:to</span> <span class="o">=&gt;</span> <span class="s2">&quot;to_index&quot;</span><span class="p">,</span> <span class="ss">:current_page</span> <span class="o">=&gt;</span> <span class="s2">&quot;current_page&quot;</span><span class="p">,</span> <span class="ss">:total</span><span class="o">=&gt;</span> <span class="s2">&quot;total_entries&quot;</span><span class="p">,</span> <span class="ss">:action</span> <span class="o">=&gt;</span> <span class="s2">&quot;getBooks(page)&quot;</span><span class="p">}</span>
</span><span class='line'>  <span class="nt">%table</span><span class="nc">.table.table-condensed.table-bordered</span>
</span><span class='line'>    <span class="nt">%thead</span>
</span><span class='line'>      <span class="nt">%th</span> S.No
</span><span class='line'>      <span class="nt">%th</span> ISBN
</span><span class='line'>      <span class="nt">%th</span> Name
</span><span class='line'>    <span class="nt">%tbody</span>
</span><span class='line'>      <span class="nt">%tr</span><span class="p">{</span><span class="ss">:ng_repeat</span> <span class="o">=&gt;</span> <span class="s2">&quot;book in books&quot;</span><span class="p">}</span>
</span><span class='line'>        <span class="nt">%td</span> 
</span><span class='line'>        <span class="nt">%td</span> 
</span><span class='line'>        <span class="nt">%td</span> 
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>Thank you for reading the post. Feel free to comment.
Happy Coding..:)</p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Connecting AngularJs Resource With Rails]]></title>
    <link href="http://sri-sankl.github.io/blog/2014/11/05/connecting-angularjs-resource-with-rails/"/>
    <updated>2014-11-05T21:59:12+05:30</updated>
    <id>http://sri-sankl.github.io/blog/2014/11/05/connecting-angularjs-resource-with-rails</id>
    <content type="html"><![CDATA[<p>RAILS <a href="http://en.wikipedia.org/wiki/Representational_state_transfer">RESTful</a> web services have made my web application development much simpler and faster. There are several javascript frameworks which provides RESTful services. <a href="https://angularjs.org/">Angular.js</a> is one of the best and popular javasript framework among them. It provides RESTful services using its <code>ng_resouce</code> API.</p>

<h2>Implementing a sample app using Rails, <em>ng, ng_resouce and ng_routes</em>.</h2>

<h4>Gems used:</h4>

<figure class='code'><figcaption><span>Gemfile  </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;haml-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 0.5.3&#39;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;angularjs-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 1.2.22&#39;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;angular-rails-templates&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<!--more-->


<ol>
<li><a href="http://haml.info">Haml</a> is a markup language used to write a well-intented and a clear structured  HTML. <a href="https://github.com/indirect/haml-rails">haml-rails</a> is a templating engine which converts haml into html.</li>
<li><a href="https://rubygems.org/gems/angularjs-rails">angularjs-rails</a> is the rails gem for angular.js library.</li>
<li><a href="https://github.com/pitr/angular-rails-templates">angular-rails-templates</a> is used to load  angular templates as part of asset pipeline.

<ul>
<li>Angular engine cannot convert haml templates into html while rendering. Hence the rendered content will be shown as a text in the web page.</li>
<li><code>angular-rails-templates</code> converts the haml files into html by using the <code>haml</code> gem. These converted html files will be loaded with the assets.</li>
<li>Since templates are cached, we can avoid the ajax calls required by angular engine to render the templates.
<br>
 <em>Create a separate directory for templates
    <br/>
  <code>$ mkdir app/assets/templates</code></em></li>
<li>configure angular-rails-templates.</li>
</ul>
</li>
</ol>


<figure class='code'><figcaption><span>config/application.rb                 </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'> config.angular_templates.module_name    <span class="o">=</span> <span class="s1">&#39;myTemplates&#39;</span>
</span><span class='line'> config.angular_templates.ignore_prefix  <span class="o">=</span> <span class="s1">&#39;templates/&#39;</span>
</span><span class='line'> config.angular_templates.markups        <span class="o">=</span> %w<span class="o">(</span>erb haml<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Yeah..! We have done with the set up. Now lets get into action.</p>

<h4>A Book Model</h4>

<p>Let us take the example of a Book resource and use RESTful API to manipulate its state. Consider the attributes ISBN, Name and Damaged(Boolean indicating whether the book is damaged or not).
  <br/></p>

<h5>Generate ruby model and controller.</h5>

<figure class='code'><figcaption><span>Generating Ruby Model and Controller</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">rails</span> <span class="n">g</span> <span class="n">model</span> <span class="n">book</span> <span class="ss">isbn</span><span class="p">:</span><span class="n">string</span> <span class="nb">name</span><span class="ss">:string</span> <span class="ss">damaged</span><span class="p">:</span><span class="n">boolean</span>
</span><span class='line'><span class="err">$</span> <span class="n">rails</span> <span class="n">g</span> <span class="n">controller</span> <span class="n">books</span>
</span></code></pre></td></tr></table></div></figure>


<h5>Configure Book at rails routes</h5>

<figure class='code'><figcaption><span>config/routes.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">resources</span> <span class="ss">:books</span>
</span></code></pre></td></tr></table></div></figure>


<h5>Include required javasript libraries</h5>

<figure class='code'><figcaption><span>app/assets/javascripts/application.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">//= require angular</span>
</span><span class='line'><span class="c1">//= require angular-resource</span>
</span><span class='line'><span class="c1">//= require angular-route.min</span>
</span><span class='line'><span class="c1">//= require angular-rails-templates</span>
</span><span class='line'><span class="c1">//= require ng_initialize</span>
</span><span class='line'><span class="c1">//= require_tree ../templates</span>
</span><span class='line'><span class="c1">//= require_tree .</span>
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p> <code>require_tree ../templates</code> loads all the haml files inside its <code>templates</code> directory and its sub directories.</p>

<h6><em>Note: Angular.js library should be loaded before its dependent libraries are loaded.</em></h6>

<h4>Bootstraping Angular App</h4>

<p>We can bootstrap angular app in two ways. <em>Automatic initialization</em> and <em>Manual initialization</em></p>

<h5>Automatic Initialization</h5>

<figure class='code'><figcaption><span>app/view/layaouts/application.html.haml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='haml'><span class='line'> <span class="nn">!!!</span>
</span><span class='line'> <span class="nt">%html</span><span class="p">{</span><span class="ss">:ng_app</span> <span class="o">=&gt;</span> <span class="s1">&#39;myApp&#39;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li><code>ng_app</code> on a html element bootstraps angular engine automatically.</li>
<li>All the siblings of <code>html</code> tag will be under the scope of <code>ng_app</code>.</li>
<li>When the angular.js library is loaded, it will search for the <code>:ng_app</code> attribute on any of the DOM element and <a href="https://docs.angularjs.org/guide/bootstrap">bootstraps</a> it.</li>
</ol>


<h5>Manual Initialization</h5>

<p>  We can get more control on angular module initilization using <a href="https://docs.angularjs.org/guide/bootstrap">manual bootstrap</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;myApp&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span class='line'>      <span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">&#39;MyController&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;$scope&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$scope</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">$scope</span><span class="p">.</span><span class="nx">greetMe</span> <span class="o">=</span> <span class="s1">&#39;World&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}]);</span>
</span><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">element</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">angular</span><span class="p">.</span><span class="nx">bootstrap</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;myApp&#39;</span><span class="p">]);</span>
</span><span class='line'>    <span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p> We will go with automatic initialization in this post.</p>

<h4>Inject dependent modules into Angular application</h4>

<figure class='code'><figcaption><span>app/assets/javascripts/ng_initialize.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">myApp</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s2">&quot;myApp&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;ngResource&#39;</span><span class="p">,</span> <span class="s1">&#39;ngRoute&#39;</span><span class="p">,</span> <span class="s1">&#39;myTemplates&#39;</span><span class="p">])</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li><code>angularjs-rails</code> gem comes with <code>ng_resource</code>. But we need to inject into it explicitly.</li>
<li><code>ngRoute</code> is used for angular routes.</li>
<li><code>myTemplates</code> is <code>module_name</code> of rails angular templates, which was configured at <em>application.rb</em>.</li>
</ol>


<h4>Define Resource</h4>

<p><em>Group <a href="https://docs.angularjs.org/guide/providers">services/factories</a> into a services directory.</em></p>

<figure class='code'><figcaption><span>app/assets/javascripts/services/book.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">angular</span><span class="p">,</span> <span class="nx">app</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">app</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s2">&quot;Book&quot;</span><span class="p">,[</span><span class="s2">&quot;$resource&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$resource</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">$resource</span><span class="p">(</span><span class="s1">&#39;/books/:id.json&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">id</span><span class="o">:</span><span class="s1">&#39;@id&#39;</span><span class="p">})</span>
</span><span class='line'>    <span class="p">}]);</span>
</span><span class='line'><span class="p">})(</span><span class="nx">angular</span><span class="p">,</span> <span class="nx">myApp</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>  The URL of the resource has an attribute <code>id</code> prefixed with <code>:</code>. It acts as a request parameter and this value will be replaced with respective attribute of the parameter hash.</p>

<ol>
<li>If the parameter hash is <code>{id: 2}</code> then the url becomes <code>/books/2.json</code>.</li>
<li>If the parameter hash is <code>{id:2, name: 'OS'}</code> then the url becomes <code>/books/2.json?name=OS</code>. Here the extra keys in hash will be added as parameters to the url after <code>?</code></li>
<li><code>@</code> symbol on any attribute will fetch the corresponding values from its data. If a <em>book</em> object is having the state as <code>{id: 2, name: 'OS', isbn:'121-340121'}</code> and the resource is <code>$resource('/books/:id.json', {id:'@id', isbn:'@isbn'})</code>. Here {id} and {isbn} would be respctive attributes of <em>book</em>.</li>
<li>The sufix of the url is a response format(<code>.json</code>). We can also make this format dynamic by changing the resource to <code>('/books/:id.:json', {id:'@id', json: '@json'})</code>
<br>
<em>We define an anonymous <a href="http://www.adequatelygood.com/JavaScript-Module-Pattern-In-Depth.html">module</a> and pass global variables <code>angular</code> and <code>myApp</code> to it, so that global scope can be avoided</em>

<h6><em>Note: Make sure that initilization of <code>myApp</code> has been done before loading this service.</em></h6>

<p><em>$resource</em> provides the following functions and their respective request types</p></li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="p">{</span> <span class="s1">&#39;get&#39;</span><span class="o">:</span>    <span class="p">{</span><span class="nx">method</span><span class="o">:</span><span class="s1">&#39;GET&#39;</span><span class="p">},</span>
</span><span class='line'>  <span class="s1">&#39;save&#39;</span><span class="o">:</span>   <span class="p">{</span><span class="nx">method</span><span class="o">:</span><span class="s1">&#39;POST&#39;</span><span class="p">},</span>
</span><span class='line'>  <span class="s1">&#39;query&#39;</span><span class="o">:</span>  <span class="p">{</span><span class="nx">method</span><span class="o">:</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="nx">isArray</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span>
</span><span class='line'>  <span class="s1">&#39;remove&#39;</span><span class="o">:</span> <span class="p">{</span><span class="nx">method</span><span class="o">:</span><span class="s1">&#39;DELETE&#39;</span><span class="p">},</span>
</span><span class='line'>  <span class="s1">&#39;delete&#39;</span><span class="o">:</span> <span class="p">{</span><span class="nx">method</span><span class="o">:</span><span class="s1">&#39;DELETE&#39;</span><span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li><code>Book.get({id: 1})</code> method makes a <code>GET /books/1.json</code> request.</li>
<li><code>Book.query()</code> method makes a <code>GET /books.json</code> request.</li>
<li><code>true</code> value of <code>isArray</code> indicates response data is in the form of Array.</li>
<li><code>false</code> value of <code>isArray</code> indicates response data is in the form of Hash.</li>
</ol>


<p>We can call <code>$method()</code> on any object(book.$save(), book.$delete()..etc). These <code>$method()s</code> returns the <a href="https://docs.angularjs.org/api/ng/service/$q">promises</a>.</p>

<h4>Books Listing :</h4>

<h5>Definie <code>index</code> action in <code>books_controller.rb</code>.</h5>

<figure class='code'><figcaption><span>app/controllers/books_controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">BooksController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">index</span>
</span><span class='line'>    <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
</span><span class='line'>      <span class="nb">format</span><span class="o">.</span><span class="n">json</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">render</span> <span class="ss">:json</span> <span class="o">=&gt;</span> <span class="no">Book</span><span class="o">.</span><span class="n">all</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>      <span class="nb">format</span><span class="o">.</span><span class="n">html</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This index action gives an array of books as json data.</p>

<h5>Define angular route to navigate to the listing page.</h5>

<figure class='code'><figcaption><span>app/assets/javascripts/router.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">angular</span><span class="p">,</span> <span class="nx">app</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">app</span><span class="p">.</span><span class="nx">config</span><span class="p">([</span><span class="s2">&quot;$routeProvider&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$routeProvider</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">$routeProvider</span>
</span><span class='line'>            <span class="p">.</span><span class="nx">when</span><span class="p">(</span><span class="s1">&#39;/books&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">templateUrl</span><span class="o">:</span> <span class="s1">&#39;books/index.html&#39;</span><span class="p">,</span>
</span><span class='line'>                <span class="nx">resolve</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>                    <span class="nx">books</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Book</span><span class="p">){</span>
</span><span class='line'>                        <span class="k">return</span> <span class="nx">Book</span><span class="p">.</span><span class="nx">query</span><span class="p">()</span>
</span><span class='line'>                    <span class="p">}</span>
</span><span class='line'>                <span class="p">},</span>
</span><span class='line'>                <span class="nx">controller</span><span class="o">:</span> <span class="s2">&quot;BooksIndexController&quot;</span>
</span><span class='line'>            <span class="p">})</span>
</span><span class='line'>    <span class="p">}]);</span>
</span><span class='line'><span class="p">})(</span><span class="nx">angular</span><span class="p">,</span> <span class="nx">myApp</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li><a href="https://docs.angularjs.org/api/ngRoute/provider/$routeProvider">$routeProvider</a> is used to create an angular routes.</li>
<li><code>when</code> adds a new route to route service</li>
<li><code>templateUrl</code> is the path to the file to be rendered after action. Angular templates engine adds <code>templates/</code> to <code>books/index.html</code> and the final file path will be <code>templates/books/index.html</code>.</li>
<li><a href="https://docs.angularjs.org/api/ngRoute/provider/$routeProvider"><code>resolve</code></a> executes before the initialization of <em>BooksIndexController</em>. The returned object can be injected into controller as a dependency.
<br/>
<code>Book.query()</code> makes a get request, resolves the promise and returns all the <code>books</code>.</li>
</ol>


<figure class='code'><figcaption><span>app/assets/javascripts/controllers/books_controller.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">angular</span><span class="p">,</span> <span class="nx">app</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s2">&quot;BooksIndexController&quot;</span><span class="p">,[</span><span class="s2">&quot;books&quot;</span><span class="p">,</span> <span class="s2">&quot;$scope&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">books</span><span class="p">,</span> <span class="nx">$scope</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">$scope</span><span class="p">.</span><span class="nx">books</span> <span class="o">=</span> <span class="nx">books</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}]);</span>
</span><span class='line'><span class="p">})(</span><span class="nx">angular</span><span class="p">,</span> <span class="nx">myApp</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>books</code> returned from resolve of route is injected into to the controller scope.</p>

<figure class='code'><figcaption><span>app/assets/templetes/books/index.html.haml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='haml'><span class='line'>  <span class="nt">%a</span><span class="p">{</span><span class="ss">:href</span> <span class="o">=&gt;</span> <span class="s2">&quot;#/new&quot;</span><span class="p">,</span> <span class="ss">:class</span> <span class="o">=&gt;</span> <span class="s2">&quot;btn btn-primary btn-sm&quot;</span><span class="p">}</span> New Book
</span><span class='line'>
</span><span class='line'>  <span class="nt">%table</span><span class="nc">.table.table-condensed.table-bordered</span>
</span><span class='line'>    <span class="nt">%thead</span>
</span><span class='line'>      <span class="nt">%th</span> ISBN
</span><span class='line'>      <span class="nt">%th</span> Name
</span><span class='line'>      <span class="nt">%th</span> Is Damaged
</span><span class='line'>      <span class="nt">%th</span>
</span><span class='line'>    <span class="nt">%tbody</span>
</span><span class='line'>      <span class="nt">%tr</span><span class="p">{</span><span class="ss">:ng_repeat</span> <span class="o">=&gt;</span> <span class="s2">&quot;book in books&quot;</span><span class="p">}</span>
</span><span class='line'>        <span class="nt">%td</span> {{book.isbn}}
</span><span class='line'>        <span class="nt">%td</span> {{book.name}}
</span><span class='line'>        <span class="nt">%td</span> {{book.damaged}}
</span><span class='line'>        <span class="nt">%td</span>
</span><span class='line'>          <span class="nt">%a</span><span class="p">{</span><span class="ss">:href</span> <span class="o">=&gt;</span> <span class="s2">&quot;#/{{book.id}</span>}/edit&quot;, :class =&gt; &quot;btn btn-warning btn-sm &quot;} Edit
</span><span class='line'>          <span class="nt">%a</span><span class="p">{</span><span class="ss">:href</span> <span class="o">=&gt;</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="ss">:ng_click</span> <span class="o">=&gt;</span> <span class="s2">&quot;destroy(book)&quot;</span><span class="p">,</span> <span class="ss">:class</span> <span class="o">=&gt;</span> <span class="s2">&quot;btn btn-danger btn-sm &quot;</span><span class="p">}</span> Delete
</span><span class='line'>          <span class="nt">%a</span><span class="p">{</span><span class="ss">:href</span> <span class="o">=&gt;</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="ss">:ng_click</span> <span class="o">=&gt;</span> <span class="s2">&quot;markAsDamaged(book)&quot;</span><span class="p">,</span> <span class="ss">:class</span> <span class="o">=&gt;</span> <span class="s2">&quot;btn btn-info btn-sm&quot;</span> <span class="p">,</span> <span class="ss">:ng_hide</span> <span class="o">=&gt;</span> <span class="s2">&quot;book.damaged&quot;</span><span class="p">}</span> Marks as damaged
</span></code></pre></td></tr></table></div></figure>


<h4>Define New Book and Save</h4>

<p>Write <code>create</code> action in <code>books_controller.rb</code></p>

<figure class='code'><figcaption><span>app/controllers/books_controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">BooksController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">create</span>
</span><span class='line'>    <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
</span><span class='line'>      <span class="nb">format</span><span class="o">.</span><span class="n">json</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">book</span> <span class="o">=</span> <span class="no">Book</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">book_params</span><span class="p">)</span>
</span><span class='line'>        <span class="n">render</span> <span class="ss">:json</span> <span class="o">=&gt;</span> <span class="n">book</span><span class="o">.</span><span class="n">save</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>The Angular router needs to be updated now</p>

<figure class='code'><figcaption><span>app/assets/javascripts/router.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">angular</span><span class="p">,</span> <span class="nx">app</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">app</span><span class="p">.</span><span class="nx">config</span><span class="p">([</span><span class="s2">&quot;$routeProvider&quot;</span><span class="p">,</span> <span class="s2">&quot;$locationProvider&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$routeProvider</span><span class="p">,</span> <span class="nx">$locationProvider</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">$routeProvider</span>
</span><span class='line'>            <span class="p">.</span><span class="nx">when</span><span class="p">(</span><span class="s1">&#39;/books&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>                 <span class="p">......</span>
</span><span class='line'>            <span class="p">})</span>
</span><span class='line'>            <span class="p">.</span><span class="nx">when</span><span class="p">(</span><span class="s1">&#39;/new&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">templateUrl</span><span class="o">:</span> <span class="s1">&#39;books/new.html&#39;</span><span class="p">,</span>
</span><span class='line'>                <span class="nx">resolve</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>                    <span class="nx">newBook</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Book</span><span class="p">){</span>
</span><span class='line'>                        <span class="k">return</span> <span class="k">new</span> <span class="nx">Book</span><span class="p">({</span><span class="nx">isbn</span><span class="o">:</span> <span class="kc">null</span> <span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">damaged</span><span class="o">:</span> <span class="kc">false</span><span class="p">})</span>
</span><span class='line'>                    <span class="p">}</span>
</span><span class='line'>                <span class="p">},</span>
</span><span class='line'>                <span class="nx">controller</span><span class="o">:</span> <span class="s2">&quot;BooksNewController&quot;</span>
</span><span class='line'>            <span class="p">})</span>
</span><span class='line'>    <span class="p">}]);</span>
</span><span class='line'><span class="p">})(</span><span class="nx">angular</span><span class="p">,</span> <span class="nx">myApp</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>#/new</code> route creates an empty book object and passes it to the <em>BooksNewController</em></p>

<figure class='code'><figcaption><span>app/assets/javascripts/controllers/books_controller.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">angular</span><span class="p">,</span> <span class="nx">app</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">......</span>
</span><span class='line'>    <span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s2">&quot;BooksNewController&quot;</span><span class="p">,[</span><span class="s2">&quot;$scope&quot;</span><span class="p">,</span> <span class="s2">&quot;$location&quot;</span><span class="p">,</span> <span class="s2">&quot;book&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">$location</span><span class="p">,</span> <span class="nx">book</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">$scope</span><span class="p">.</span><span class="nx">book</span> <span class="o">=</span> <span class="nx">book</span>
</span><span class='line'>    <span class="p">}]);</span>
</span><span class='line'>
</span><span class='line'><span class="p">})(</span><span class="nx">angular</span><span class="p">,</span> <span class="nx">myApp</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here is the form defining creation of a new book</p>

<figure class='code'><figcaption><span>app/assets/templetes/books/new.html.haml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='haml'><span class='line'><span class="nt">%form</span><span class="p">{</span><span class="ss">:method</span> <span class="o">=&gt;</span> <span class="s2">&quot;post&quot;</span><span class="p">,</span> <span class="ss">:class</span> <span class="o">=&gt;</span> <span class="s2">&quot;form-horizantal&quot;</span><span class="p">,</span> <span class="ss">:ng_submit</span> <span class="o">=&gt;</span> <span class="s2">&quot;submit()&quot;</span><span class="p">}</span>
</span><span class='line'>  <span class="nc">.form-groupe</span>
</span><span class='line'>    <span class="nt">%label</span><span class="nc">.control-label</span> ISBN
</span><span class='line'>    <span class="nt">%input</span><span class="p">{</span><span class="ss">:type</span> <span class="o">=&gt;</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="ss">:ng_model</span> <span class="o">=&gt;</span> <span class="s2">&quot;book.isbn&quot;</span><span class="p">}</span>
</span><span class='line'>  <span class="nc">.form-groupe</span>
</span><span class='line'>    <span class="nt">%label</span><span class="nc">.control-label</span> Name
</span><span class='line'>    <span class="nt">%input</span><span class="p">{</span><span class="ss">:type</span> <span class="o">=&gt;</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="ss">:ng_model</span> <span class="o">=&gt;</span> <span class="s2">&quot;book.name&quot;</span><span class="p">}</span>
</span><span class='line'>  <span class="nc">.form-groupe</span>
</span><span class='line'>    <span class="nt">%button</span><span class="p">{</span><span class="ss">:type</span> <span class="o">=&gt;</span> <span class="s2">&quot;submit&quot;</span><span class="p">}</span> Save
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>new.html.haml is under the <em>BooksNewController</em>&rsquo;s scope</li>
<li>All the book attributes are bounded with <code>ng_model</code> of form inputs. When we submit the form it invokes <code>submit()</code> of <code>ng_submit</code> attribute.
Let us add submit function in <em>BooksNewController</em></li>
</ol>


<figure class='code'><figcaption><span>app/assets/javascripts/controllers/books_controller.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">angular</span><span class="p">,</span> <span class="nx">app</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">......</span>
</span><span class='line'>    <span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s2">&quot;BooksNewController&quot;</span><span class="p">,[</span><span class="s2">&quot;$scope&quot;</span><span class="p">,</span> <span class="s2">&quot;$location&quot;</span><span class="p">,</span> <span class="s2">&quot;book&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">$location</span><span class="p">,</span> <span class="nx">book</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">$scope</span><span class="p">.</span><span class="nx">book</span> <span class="o">=</span> <span class="nx">book</span>
</span><span class='line'>        <span class="nx">$scope</span><span class="p">.</span><span class="nx">submit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>            <span class="nx">$scope</span><span class="p">.</span><span class="nx">book</span><span class="p">.</span><span class="nx">$save</span><span class="p">()</span>
</span><span class='line'>                <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                    <span class="nx">$location</span><span class="p">.</span><span class="nx">path</span><span class="p">(</span><span class="s2">&quot;/books&quot;</span><span class="p">)</span>
</span><span class='line'>                <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">reason</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                    <span class="c1">// handle failure</span>
</span><span class='line'>                <span class="p">});</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}]);</span>
</span><span class='line'>
</span><span class='line'><span class="p">})(</span><span class="nx">angular</span><span class="p">,</span> <span class="nx">myApp</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>On successfull creation of book, <a href="https://docs.angularjs.org/api/ng/service/$location">$location</a> redirects to <code>/books</code> route.</p>

<h4>Edit and Update Book</h4>

<p>Let us update <code>books_controller.rb</code> to include functionality to update a book</p>

<figure class='code'><figcaption><span>app/controllers/books_controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">BooksController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">show</span>
</span><span class='line'>    <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
</span><span class='line'>      <span class="nb">format</span><span class="o">.</span><span class="n">json</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">book</span> <span class="o">=</span> <span class="no">Book</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>        <span class="n">render</span> <span class="ss">:json</span> <span class="o">=&gt;</span> <span class="n">book</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">update</span>
</span><span class='line'>    <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
</span><span class='line'>      <span class="nb">format</span><span class="o">.</span><span class="n">json</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">book</span> <span class="o">=</span> <span class="no">Book</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>        <span class="n">render</span> <span class="ss">:json</span> <span class="o">=&gt;</span> <span class="n">book</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">book_params</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Define <em>update</em> action in <em>resource</em></h4>

<p>Default actions of <code>$resource</code> will not include Update action. We have to configure it.</p>

<figure class='code'><figcaption><span>app/assets/javascripts/services/book.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">angular</span><span class="p">,</span> <span class="nx">app</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">app</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s2">&quot;Book&quot;</span><span class="p">,[</span><span class="s2">&quot;$resource&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$resource</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">$resource</span><span class="p">(</span><span class="s1">&#39;/books/:id.json&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">id</span><span class="o">:</span><span class="s1">&#39;@id&#39;</span><span class="p">},</span>
</span><span class='line'>                         <span class="p">{</span>
</span><span class='line'>                             <span class="s2">&quot;update&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="nx">method</span><span class="o">:</span> <span class="s2">&quot;PUT&quot;</span><span class="p">}</span>
</span><span class='line'>                         <span class="p">}</span>
</span><span class='line'>                        <span class="p">);</span>
</span><span class='line'>    <span class="p">}]);</span>
</span><span class='line'><span class="p">})(</span><span class="nx">angular</span><span class="p">,</span> <span class="nx">myApp</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Update angular router for edit action</h4>

<figure class='code'><figcaption><span>app/assets/javascripts/router.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">angular</span><span class="p">,</span> <span class="nx">app</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">app</span><span class="p">.</span><span class="nx">config</span><span class="p">([</span><span class="s2">&quot;$routeProvider&quot;</span><span class="p">,</span> <span class="s2">&quot;$locationProvider&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$routeProvider</span><span class="p">,</span> <span class="nx">$locationProvider</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">$routeProvider</span>
</span><span class='line'>            <span class="p">.</span><span class="nx">when</span><span class="p">(</span><span class="s1">&#39;/books&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>                 <span class="p">......</span>
</span><span class='line'>            <span class="p">})</span>
</span><span class='line'>            <span class="p">.</span><span class="nx">when</span><span class="p">(</span><span class="s1">&#39;/new&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>                 <span class="p">......</span>
</span><span class='line'>            <span class="p">})</span>
</span><span class='line'>            <span class="p">.</span><span class="nx">when</span><span class="p">(</span><span class="s1">&#39;/:id/edit&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">templateUrl</span><span class="o">:</span> <span class="s1">&#39;books/new.html&#39;</span><span class="p">,</span>
</span><span class='line'>                <span class="nx">resolve</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>                    <span class="nx">book</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Book</span><span class="p">,</span> <span class="nx">$route</span><span class="p">){</span>
</span><span class='line'>                        <span class="k">return</span> <span class="nx">Book</span><span class="p">.</span><span class="nx">get</span><span class="p">({</span><span class="nx">id</span><span class="o">:</span> <span class="nx">$route</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">})</span>
</span><span class='line'>                    <span class="p">}</span>
</span><span class='line'>                <span class="p">},</span>
</span><span class='line'>                <span class="nx">controller</span><span class="o">:</span> <span class="s2">&quot;BooksEditController&quot;</span>
</span><span class='line'>            <span class="p">})</span>
</span><span class='line'>    <span class="p">}]);</span>
</span><span class='line'><span class="p">})(</span><span class="nx">angular</span><span class="p">,</span> <span class="nx">myApp</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>Get request parameters using <a href="https://docs.angularjs.org/api/ngRoute/service/$route"><code>$route</code></a>.</li>
<li>Use <code>$route.current.params</code>  instead of <a href="https://docs.angularjs.org/api/ngRoute/service/$routeParams">$routeParams</a> to access the new current route parameters.</li>
<li><code>Book.get({id: $route.current.params.id})</code> makes the GET request with url like &ldquo;/books/1.json&rdquo;.</li>
<li>Now the <em>Book</em> state is <code>"book"=&gt;{"id"=&gt;"1", "isbn"=&gt;"81-7596-067-1", "name"=&gt;"Old Book Name", "damaged"=&gt;false}</code></li>
</ol>


<h4>Handle update in angular controller</h4>

<figure class='code'><figcaption><span>app/assets/javascripts/controllers/books_controller.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">angular</span><span class="p">,</span> <span class="nx">app</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">......</span>
</span><span class='line'>    <span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s2">&quot;BooksEditController&quot;</span><span class="p">,[</span><span class="s2">&quot;book&quot;</span><span class="p">,</span> <span class="s2">&quot;$scope&quot;</span><span class="p">,</span><span class="s2">&quot;$location&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">book</span><span class="p">,</span> <span class="nx">$scope</span><span class="p">,</span> <span class="nx">$location</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">$scope</span><span class="p">.</span><span class="nx">book</span> <span class="o">=</span> <span class="nx">book</span>
</span><span class='line'>        <span class="nx">$scope</span><span class="p">.</span><span class="nx">submit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>            <span class="nx">$scope</span><span class="p">.</span><span class="nx">book</span><span class="p">.</span><span class="nx">$update</span><span class="p">()</span>
</span><span class='line'>                <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                    <span class="nx">$location</span><span class="p">.</span><span class="nx">path</span><span class="p">(</span><span class="s2">&quot;/books&quot;</span><span class="p">)</span>
</span><span class='line'>                <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">reason</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                    <span class="c1">// handle failure</span>
</span><span class='line'>                <span class="p">});</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}]);</span>
</span><span class='line'>
</span><span class='line'><span class="p">})(</span><span class="nx">angular</span><span class="p">,</span> <span class="nx">myApp</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>The submitted form here calls the <code>$update()</code> function on book.</li>
<li>It makes the PUT <code>/books/1.json</code> and params will be <code>"book"=&gt;{"id"=&gt;"1", "isbn"=&gt;"81-7596-067-1", "name"=&gt;"New Book Name", "damaged"=&gt;false}</code></li>
</ol>


<h3>Delete Book</h3>

<p>Since all the books are rendered under the  <em>BooksIndexController</em> scope, let us define <code>destroy()</code> method in the same controller.</p>

<figure class='code'><figcaption><span>app/assets/javascripts/controllers/books_controller.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">angular</span><span class="p">,</span> <span class="nx">app</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s2">&quot;BooksIndexController&quot;</span><span class="p">,[</span><span class="s2">&quot;books&quot;</span><span class="p">,</span> <span class="s2">&quot;$scope&quot;</span><span class="p">,</span> <span class="s2">&quot;$route&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">books</span><span class="p">,</span> <span class="nx">$scope</span><span class="p">,</span> <span class="nx">$route</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">$scope</span><span class="p">.</span><span class="nx">books</span> <span class="o">=</span> <span class="nx">books</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">$scope</span><span class="p">.</span><span class="nx">destroy</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">book</span><span class="p">){</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="nx">confirm</span><span class="p">(</span><span class="s2">&quot;Are You Sure?&quot;</span><span class="p">)){</span>
</span><span class='line'>                <span class="nx">book</span><span class="p">.</span><span class="nx">$delete</span><span class="p">()</span>
</span><span class='line'>                    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
</span><span class='line'>                        <span class="nx">$route</span><span class="p">.</span><span class="nx">reload</span><span class="p">();</span>
</span><span class='line'>                    <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">reason</span><span class="p">){</span>
</span><span class='line'>                       <span class="c1">// handle failure   </span>
</span><span class='line'>                    <span class="p">});</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}]);</span>
</span><span class='line'><span class="p">})(</span><span class="nx">angular</span><span class="p">,</span> <span class="nx">myApp</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>Call <code>$delete()</code> function on a book to destroy it. It creates DELETE <code>/books/1.json</code> request</li>
<li>If the book is deleted successfully, <code>$route.reload()</code> reloads the current page.</li>
</ol>


<h3>Custom Actions</h3>

<p>We have used CRUD action on the resource so far. We can also make custom calls on the resource</p>

<figure class='code'><figcaption><span>app/assets/javascripts/services/book.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">angular</span><span class="p">,</span> <span class="nx">app</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">app</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s2">&quot;Book&quot;</span><span class="p">,[</span><span class="s2">&quot;$resource&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$resource</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">$resource</span><span class="p">(</span><span class="s1">&#39;/books/:id.json&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">id</span><span class="o">:</span><span class="s1">&#39;@id&#39;</span><span class="p">},</span>
</span><span class='line'>                         <span class="p">{</span>
</span><span class='line'>                             <span class="s2">&quot;update&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="nx">method</span><span class="o">:</span> <span class="s2">&quot;PUT&quot;</span><span class="p">},</span>
</span><span class='line'>                             <span class="s2">&quot;markAsDamaged&quot;</span><span class="o">:</span><span class="p">{</span><span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;/books/:id/mark_as_damaged.json&quot;</span><span class="p">,</span> <span class="nx">method</span><span class="o">:</span> <span class="s2">&quot;PUT&quot;</span><span class="p">}</span>
</span><span class='line'>                             <span class="s2">&quot;damagedBooks&quot;</span><span class="o">:</span><span class="p">{</span><span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;/books/damaged_books.json&quot;</span><span class="p">,</span> <span class="nx">method</span><span class="o">:</span> <span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="nx">isArray</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span>
</span><span class='line'>                         <span class="p">}</span>
</span><span class='line'>                        <span class="p">);</span>
</span><span class='line'>    <span class="p">}]);</span>
</span><span class='line'><span class="p">})(</span><span class="nx">angular</span><span class="p">,</span> <span class="nx">myApp</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>These custom actions needs complete Url.</p>

<ol>
<li><code>markAsDamaged</code> is called on book object to changes its status to damaged. <code>book.$markAsDamaged()</code> create a <code>PUT</code> request and url as <code>/books/1/mark_as_damaged.json</code></li>
<li><code>damagedBooks</code> gets an array of damaged books. Book.damaged_books() makes a <code>GET</code> request and url as <code>books/damaged_books.json</code></li>
</ol>


<h4>Configure custom action in routes.rb</h4>

<figure class='code'><figcaption><span>config/routes.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="n">resources</span> <span class="ss">:books</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">member</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">put</span> <span class="s2">&quot;mark_as_damaged&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="n">collection</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">get</span> <span class="s2">&quot;damaged_books&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>update books_controller.rb</p>

<figure class='code'><figcaption><span>app/controllers/books_controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">BooksController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">mark_as_damaged</span>
</span><span class='line'>    <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
</span><span class='line'>      <span class="nb">format</span><span class="o">.</span><span class="n">json</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">book</span> <span class="o">=</span> <span class="no">Book</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>        <span class="n">book</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="ss">:damaged</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">)</span>
</span><span class='line'>        <span class="n">render</span> <span class="ss">:json</span> <span class="o">=&gt;</span> <span class="n">book</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Define <code>markAsDamaged()</code> function in <em>BooksIndexController</em></p>

<figure class='code'><figcaption><span>app/assets/javascripts/controllers/books_controller.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">angular</span><span class="p">,</span> <span class="nx">app</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s2">&quot;BooksIndexController&quot;</span><span class="p">,[</span><span class="s2">&quot;books&quot;</span><span class="p">,</span> <span class="s2">&quot;$scope&quot;</span><span class="p">,</span> <span class="s2">&quot;$location&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">books</span><span class="p">,</span> <span class="nx">$scope</span><span class="p">,</span> <span class="nx">$location</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">$scope</span><span class="p">.</span><span class="nx">books</span> <span class="o">=</span> <span class="nx">books</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nx">$scope</span><span class="p">.</span><span class="nx">destroy</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">book</span><span class="p">){</span>
</span><span class='line'>                 <span class="p">.......</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="nx">$scope</span><span class="p">.</span><span class="nx">markAsDamaged</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">book</span><span class="p">){</span>
</span><span class='line'>            <span class="nx">book</span><span class="p">.</span><span class="nx">$markAsDamaged</span><span class="p">()</span>
</span><span class='line'>                <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
</span><span class='line'>                    <span class="nx">book</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
</span><span class='line'>                <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">reason</span><span class="p">){</span>
</span><span class='line'>                   <span class="c1">// handle error</span>
</span><span class='line'>                <span class="p">});</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">}]);</span>
</span><span class='line'><span class="p">})(</span><span class="nx">angular</span><span class="p">,</span> <span class="nx">myApp</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>I hope by now you would know how to define <code>damaged_books()</code> handler in the <em>BooksIndexController</em>.
<br/></p>

<p>You can find this git hub repo at <a href="https://github.com/sri-sankl/ng_resouce_with_rails">ng_resouce_with_rails</a></p>

<blockquote><p>Thank you for reading the post. Feel free to comment.
Happy Coding..:)</p></blockquote>
]]></content>
  </entry>
  
</feed>
